- hosts: all

- name: Installation de Symfony
  hosts: all
  remote_user: root
  tasks:
    - name: Installer Git
    apt: name=git state=latest
      - name : Installer Symfony
    command: chdir=/var/www/ git clone https://github.com/symfony/symfony.git

- name: téléchager composer
  get_url:
    url: https://getcomposer.org/installer
    dest: /tmp/installer
  tags: composer

- name: installer composer
  shell: cat /tmp/installer | php -- --install-dir=/usr/local/bin
  args:
    creates: /usr/local/bin/composer
  tags: composer

- name: renommer composer.phar en composer
  shell: mv /usr/local/bin/composer.phar /usr/local/bin/composer
  args:
    creates: /usr/local/bin/composer
  tags: composer

- name: rendre composer exécutable
  file:
    path: /usr/local/bin/composer
    mode: a+x
    state: file
  tags: composer

- stat: path=/var/www/symfony/composer.lock
    register: composer_file

- name: composer install symfony
  command: chdir=/var/www/symfony composer install
  when: composer_file.stat.exists == False

- name: composer update symfony
  command: chdir=/var/www/symfony composer update
  when: composer_file.stat.exists == True

### PACKAGE SERVER

- name: Installation du package
    apt: name={{ item }} state=latest
    with_items:
      - apache2
      - libapache2-mod-php7.0
      - php7.0
      - php7.0-fpm
      - php7.0-mysql
      - php7.0-curl
      - curl
      - php7.0-mbstring
      - php7.0-xml
      - php7.0-zip
      - php7.0-cli
      - php7.0-bcmath

    - name: enabled mod_rewrite
      apache2_module: name=rewrite state=present
      notify:
        - restart apache2